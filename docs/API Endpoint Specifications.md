# API Endpoint Specifications

## Overview

This document provides comprehensive specifications for all API endpoints in the Cache-Only Rentman API Backend, including request/response formats, authentication requirements, and usage examples.

***

## 1. Base Configuration

### 1.1. Base URLs
- **Main API**: `https://api.london-move.com`
- **Admin API**: `https://api.london-move.com/admin`
- **WebSocket**: `wss://api.london-move.com/ws`

### 1.2. Common Headers
```http
Content-Type: application/json
Accept: application/json
Authorization: Bearer <token> (for admin endpoints)
```

### 1.3. Standard Response Format
```typescript
interface ApiResponse<T> {
  data: T;
  success: boolean;
  message?: string;
  meta?: {
    pagination?: PaginationMeta;
    cache?: CacheMeta;
    performance?: PerformanceMeta;
  };
}

interface ErrorResponse {
  error: string;
  details?: any;
  code: string;
  timestamp: string;
}
```

***

## 2. Public Property Endpoints

### 2.1. GET /api/properties
Retrieve paginated property listings with filtering capabilities.

**Query Parameters:**
```typescript
interface PropertyFilters {
  rob?: 'rent' | 'sale';           // Property type filter
  featured?: '1';                  // Featured properties only
  area?: string;                   // Area/postcode filter
  beds?: number;                   // Minimum bedrooms
  maxPrice?: number;               // Maximum price filter
  minPrice?: number;               // Minimum price filter
  type?: string;                   // Property type (e.g., 'Flat', 'House')
  limit?: number;                  // Items per page (default: 25, max: 100)
  page?: number;                   // Page number (default: 1)
}
```

**Response:**
```typescript
interface PropertyListResponse {
  data: PropertyListing[];
  meta: {
    pagination: {
      current: number;
      total: number;
      pages: number;
      hasNext: boolean;
      hasPrev: boolean;
    };
    cache: {
      hit: boolean;
      ttl: number;
      key: string;
    };
    filters: PropertyFilters;
  };
}

interface PropertyListing {
  propref: string;
  displayaddress: string;
  displayprice: string;
  beds: number;
  baths: number;
  type: string;
  status: string;
  featured: boolean;
  thumbnailUrl?: string;
  area: string;
  geolocation?: [number, number];
  available: string;
}
```

**Example Request:**
```bash
GET /api/properties?rob=rent&beds=2&area=London&limit=20&page=1
```

**Example Response:**
```json
{
  "data": [
    {
      "propref": "123",
      "displayaddress": "Modern Flat, Central London",
      "displayprice": "£2,500 pcm",
      "beds": 2,
      "baths": 1,
      "type": "Flat",
      "status": "Available",
      "featured": true,
      "thumbnailUrl": "https://cdn.london-move.com/images/123/thumbnail_webp",
      "area": "Central London",
      "geolocation": [51.5074, -0.1278],
      "available": "2024-01-15"
    }
  ],
  "meta": {
    "pagination": {
      "current": 1,
      "total": 156,
      "pages": 8,
      "hasNext": true,
      "hasPrev": false
    },
    "cache": {
      "hit": true,
      "ttl": 240,
      "key": "properties:hash_abc123"
    }
  }
}
```

### 2.2. GET /api/properties/featured
Retrieve auto-selected featured properties optimized for frontend display.

**Query Parameters:**
```typescript
interface AutoFeaturedParams {
  optimized?: 'true';              // Return frontend-optimized response
  images?: 'true';                 // Include optimized image data
  preload?: 'true';               // Include preload hints
  variant?: 'thumbnail' | 'card' | 'hero'; // Image variant (default: 'card')
}
```

**Enhanced Response for Frontend:**
```typescript
interface EnhancedAutoFeaturedResponse {
  data: EnhancedPropertyListing[];
  meta: {
    count: number;
    autoGenerated: true;
    lastRefresh: string;
    nextRefresh: string;
    diversityScore: number;
    selectionTrigger: string;
    cache: CacheMeta;
    imageOptimization: {
      enabled: boolean;
      formats: ['avif', 'webp', 'jpeg'];
      variants: string[];
      responsive: boolean;
    };
    performance: {
      responseTime: number;
      cacheHit: boolean;
      preloadHints: boolean;
    };
  };
}

interface EnhancedPropertyListing extends PropertyListing {
  // Optimized image data ready for immediate use
  heroImage?: {
    sources: Array<{
      type: string;
      srcset: string;
      sizes: string;
    }>;
    fallbackSrc: string;
    alt: string;
    aspectRatio: string;
    blurDataURL: string;
    backgroundColor: string;
    loading: 'lazy' | 'eager';
  };
  
  thumbnailImage?: {
    sources: Array<{
      type: string;
      srcset: string;
      sizes: string;
    }>;
    fallbackSrc: string;
    alt: string;
    aspectRatio: string;
    blurDataURL: string;
    loading: 'lazy' | 'eager';
  };
  
  // Performance optimizations
  preloadHints?: {
    dns: string[];
    preconnect: string[];
    prefetch: string[];
  };
  
  // SEO enhancements
  seo: {
    title: string;
    description: string;
    keywords: string[];
    structuredData: PropertyStructuredData;
  };
}
```

**Example:**
```bash
GET /api/properties/featured?optimized=true&images=true&variant=hero&preload=true
```

**Enhanced Example Response:**
```json
{
  "data": [
    {
      "propref": "123",
      "displayaddress": "Modern Flat, Central London",
      "displayprice": "£2,500 pcm",
      "beds": 2,
      "baths": 1,
      "type": "Flat",
      "status": "Available",
      "featured": true,
      "area": "Central London",
      "geolocation": [51.5074, -0.1278],
      "available": "2024-01-15",
      
      "heroImage": {
        "sources": [
          {
            "type": "image/avif",
            "srcset": "https://cdn.london-move.com/images/123/hero_avif 1x, https://cdn.london-move.com/images/123/hero_2x_avif 2x",
            "sizes": "(max-width: 1200px) 100vw, 1200px"
          },
          {
            "type": "image/webp",
            "srcset": "https://cdn.london-move.com/images/123/hero_webp 1x, https://cdn.london-move.com/images/123/hero_2x_webp 2x",
            "sizes": "(max-width: 1200px) 100vw, 1200px"
          },
          {
            "type": "image/jpeg",
            "srcset": "https://cdn.london-move.com/images/123/hero_jpeg 1x, https://cdn.london-move.com/images/123/hero_2x_jpeg 2x",
            "sizes": "(max-width: 1200px) 100vw, 1200px"
          }
        ],
        "fallbackSrc": "https://cdn.london-move.com/images/123/hero_jpeg",
        "alt": "Modern Flat, Central London - Hero Image",
        "aspectRatio": "3/2",
        "blurDataURL": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD...",
        "backgroundColor": "rgb(240, 240, 245)",
        "loading": "eager"
      },
      
      "thumbnailImage": {
        "sources": [
          {
            "type": "image/avif",
            "srcset": "https://cdn.london-move.com/images/123/thumbnail_avif 1x, https://cdn.london-move.com/images/123/thumbnail_2x_avif 2x, https://cdn.london-move.com/images/123/thumbnail_3x_avif 3x",
            "sizes": "(max-width: 300px) 100vw, 300px"
          },
          {
            "type": "image/webp",
            "srcset": "https://cdn.london-move.com/images/123/thumbnail_webp 1x, https://cdn.london-move.com/images/123/thumbnail_2x_webp 2x, https://cdn.london-move.com/images/123/thumbnail_3x_webp 3x",
            "sizes": "(max-width: 300px) 100vw, 300px"
          },
          {
            "type": "image/jpeg",
            "srcset": "https://cdn.london-move.com/images/123/thumbnail_jpeg 1x, https://cdn.london-move.com/images/123/thumbnail_2x_jpeg 2x, https://cdn.london-move.com/images/123/thumbnail_3x_jpeg 3x",
            "sizes": "(max-width: 300px) 100vw, 300px"
          }
        ],
        "fallbackSrc": "https://cdn.london-move.com/images/123/thumbnail_jpeg",
        "alt": "Modern Flat, Central London - Thumbnail",
        "aspectRatio": "3/2",
        "blurDataURL": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD...",
        "loading": "lazy"
      },
      
      "preloadHints": {
        "dns": ["cdn.london-move.com", "fonts.googleapis.com"],
        "preconnect": ["https://cdn.london-move.com", "https://fonts.googleapis.com"],
        "prefetch": [
          "https://cdn.london-move.com/images/123/card_avif",
          "https://cdn.london-move.com/images/123/card_webp"
        ]
      },
      
      "seo": {
        "title": "Modern 2 Bedroom Flat for Rent in Central London - £2,500 pcm",
        "description": "Discover this stunning modern 2-bedroom flat in the heart of Central London. Available now for £2,500 per calendar month.",
        "keywords": ["london", "flat", "rent", "2 bedroom", "central london", "modern"],
        "structuredData": {
          "@type": "RealEstateListing",
          "name": "Modern Flat, Central London",
          "url": "https://london-move.com/properties/123",
          "price": "2500",
          "priceCurrency": "GBP"
        }
      }
    }
  ],
  
  "meta": {
    "count": 7,
    "autoGenerated": true,
    "lastRefresh": "2024-01-15T10:30:00Z",
    "nextRefresh": "2024-01-15T14:30:00Z",
    "diversityScore": 0.85,
    "selectionTrigger": "scheduled",
    "cache": {
      "hit": true,
      "ttl": 1800,
      "key": "properties:auto-featured"
    },
    "imageOptimization": {
      "enabled": true,
      "formats": ["avif", "webp", "jpeg"],
      "variants": ["hero", "thumbnail"],
      "responsive": true
    },
    "performance": {
      "responseTime": 45,
      "cacheHit": true,
      "preloadHints": true
    }
  }
}
```

### 2.3. GET /api/properties/search
Advanced property search with full-text capabilities.

**Query Parameters:**
```typescript
interface SearchParams {
  q: string;                       // Search query (required)
  rob?: 'rent' | 'sale';
  beds?: number;
  maxPrice?: number;
  minPrice?: number;
  area?: string;
  limit?: number;
  page?: number;
}
```

**Response:**
```typescript
interface SearchResponse {
  data: PropertyListing[];
  meta: {
    query: string;
    results: number;
    suggestions?: string[];
    pagination: PaginationMeta;
    searchTime: number;
  };
}
```

**Example:**
```bash
GET /api/properties/search?q=modern+apartment&beds=2&maxPrice=3000
```

### 2.4. GET /api/properties/:id
Retrieve detailed information for a specific property.

**Path Parameters:**
- `id`: Property reference (propref)

**Response:**
```typescript
interface PropertyDetailResponse {
  data: PropertyDetail;
  meta: {
    cache: CacheMeta;
    relatedProperties?: string[];
  };
}

interface PropertyDetail {
  propref: string;
  displayaddress: string;
  displayprice: string;
  rentmonth: string;
  rentorbuy: '1' | '2' | '3';
  
  // Address details
  number: string;
  street: string;
  address3: string;
  address4: string;
  postcode: string;
  area: string;
  geolocation: string;
  
  // Property details
  type: string;
  beds: string;
  singles: string;
  doubles: string;
  baths: string;
  receps: string;
  furnished: '1' | '2' | '3' | '4';
  
  // Description
  description: string;
  comments: string;
  strapline: string;
  bullets: string;
  
  // Features
  heating: string;
  floor: string;
  age: string;
  rating: string;
  
  // Availability
  available: string;
  status: string;
  shortlet: boolean;
  
  // Media
  photos: string[];
  floorplan?: string;
  epc?: string;
  virtualTour?: string;
  
  // Contact
  negotiator: {
    name: string;
    email: string;
    mobile: string;
  };
  branch: {
    name: string;
    telephone: string;
  };
  
  // Meta
  featured: boolean;
  lastUpdated: string;
}
```

**Example:**
```bash
GET /api/properties/123
```

### 2.5. GET /api/properties/:id/media
Retrieve optimized media for a specific property.

**Path Parameters:**
- `id`: Property reference

**Query Parameters:**
```typescript
interface MediaParams {
  variant?: 'thumbnail' | 'card' | 'full';  // Image variant (default: 'card')
  type?: 'photos' | 'floorplan' | 'epc';    // Media type filter
}
```

**Response:**
```typescript
interface MediaResponse {
  data: PropertyMedia[];
  meta: {
    totalImages: number;
    variant: string;
    processingStatus: 'complete' | 'processing' | 'failed';
  };
}

interface PropertyMedia {
  filename: string;
  caption: string;
  type: 'photo' | 'floorplan' | 'epc' | 'brochure';
  urls: {
    thumbnail: string;
    card: string;
    full: string;
  };
  metadata: {
    width: number;
    height: number;
    size: number;
    format: string;
  };
  order: number;
}
```

**Example:**
```bash
GET /api/properties/123/media?variant=card&type=photos
```

### 2.6. GET /api/areas
Retrieve available areas/postcodes for filtering.

**Response:**
```typescript
interface AreasResponse {
  data: Area[];
  meta: {
    totalAreas: number;
    cache: CacheMeta;
  };
}

interface Area {
  name: string;
  type: 'postcode' | 'area';
  properties: number;
  avgPrice: number;
  bounds?: {
    north: number;
    south: number;
    east: number;
    west: number;
  };
}
```

***

## 3. Admin API Endpoints

### 3.1. Authentication

#### POST /admin/api/auth/login
Admin authentication endpoint.

**Request:**
```typescript
interface LoginRequest {
  email: string;
  password: string;
}
```

**Response:**
```typescript
interface LoginResponse {
  token: string;
  user: {
    id: string;
    email: string;
    role: 'admin' | 'editor';
    permissions: string[];
  };
  expiresIn: number;
}
```

#### POST /admin/api/auth/refresh
Refresh authentication token.

**Request:**
```typescript
interface RefreshRequest {
  refreshToken: string;
}
```

### 3.2. Property Management

#### GET /admin/api/properties
Admin property listing with extended filters.

**Query Parameters:**
```typescript
interface AdminPropertyFilters extends PropertyFilters {
  status?: 'all' | 'available' | 'under-offer' | 'let';
  featured?: 'all' | 'featured' | 'unfeatured';
  lastUpdated?: string;        // ISO date
  negotiator?: string;         // Negotiator name filter
}
```

#### POST /admin/api/properties/:id/featured
Toggle featured status for a property.

**Request:**
```typescript
interface FeaturedUpdateRequest {
  featured: boolean;
  reason?: string;
}
```

**Response:**
```typescript
interface FeaturedUpdateResponse {
  success: true;
  previousState: boolean;
  audit: {
    userId: string;
    timestamp: string;
    action: 'featured' | 'unfeatured';
  };
}
```

#### POST /admin/api/properties/bulk/featured
Bulk update featured status for multiple properties.

**Request:**
```typescript
interface BulkFeaturedRequest {
  proprefs: string[];
  featured: boolean;
  reason?: string;
}
```

**Response:**
```typescript
interface BulkFeaturedResponse {
  success: true;
  updated: number;
  failed: {
    propref: string;
    error: string;
  }[];
  audit: AuditEntry;
}
```

### 3.3. Cache Management

#### GET /admin/api/cache/metrics
Retrieve cache performance metrics.

**Response:**
```typescript
interface CacheMetricsResponse {
  data: {
    hitRate: number;
    totalRequests: number;
    totalHits: number;
    totalMisses: number;
    avgResponseTime: number;
    cacheSize: number;
    topKeys: {
      key: string;
      hits: number;
      size: number;
      ttl: number;
    }[];
    performance: {
      last24h: MetricPoint[];
      last7d: MetricPoint[];
    };
  };
  meta: {
    collectedAt: string;
    nextUpdate: string;
  };
}

interface MetricPoint {
  timestamp: string;
  hitRate: number;
  responseTime: number;
  requests: number;
}
```

#### POST /admin/api/cache/invalidate
Invalidate cache by pattern.

**Request:**
```typescript
interface CacheInvalidateRequest {
  pattern: string;
  reason?: string;
}
```

**Response:**
```typescript
interface CacheInvalidateResponse {
  success: true;
  keysInvalidated: number;
  pattern: string;
  audit: AuditEntry;
}
```

#### POST /admin/api/cache/warm
Warm cache for specific patterns.

**Request:**
```typescript
interface CacheWarmRequest {
  patterns: string[];
  priority: 'high' | 'normal' | 'low';
}
```

### 3.4. Analytics

#### GET /admin/api/analytics/popular-properties
Get most viewed properties.

**Query Parameters:**
```typescript
interface PopularPropertiesParams {
  period?: '24h' | '7d' | '30d';
  limit?: number;
  rob?: 'rent' | 'sale';
}
```

**Response:**
```typescript
interface PopularPropertiesResponse {
  data: {
    propref: string;
    displayaddress: string;
    displayprice: string;
    views: number;
    uniqueViews: number;
    featured: boolean;
    conversionRate: number;
  }[];
  meta: {
    period: string;
    totalViews: number;
    totalProperties: number;
  };
}
```

#### GET /admin/api/analytics/search-terms
Get popular search terms.

**Response:**
```typescript
interface SearchTermsResponse {
  data: {
    term: string;
    count: number;
    resultsFound: number;
    avgResultsClicked: number;
  }[];
  meta: {
    totalSearches: number;
    period: string;
  };
}
```

#### GET /admin/api/analytics/performance
Get API performance metrics.

**Response:**
```typescript
interface PerformanceResponse {
  data: {
    endpoints: {
      path: string;
      avgResponseTime: number;
      requests: number;
      errorRate: number;
    }[];
    responseTime: MetricPoint[];
    errorRate: MetricPoint[];
    throughput: MetricPoint[];
  };
}
```

***

## 4. Real-time WebSocket Events

### 4.1. Connection
```typescript
// Connect to WebSocket
const ws = new WebSocket('wss://api.london-move.com/ws/admin?token=<jwt_token>');
```

### 4.2. Event Types

#### Property Updates
```typescript
interface PropertyUpdateEvent {
  type: 'PROPERTY_UPDATED';
  propref: string;
  changes: {
    field: string;
    oldValue: any;
    newValue: any;
  }[];
  timestamp: string;
}
```

#### Featured Status Changes
```typescript
interface FeaturedChangeEvent {
  type: 'FEATURED_CHANGED';
  propref: string;
  featured: boolean;
  userId: string;
  timestamp: string;
}
```

#### Cache Events
```typescript
interface CacheInvalidatedEvent {
  type: 'CACHE_INVALIDATED';
  pattern: string;
  keysAffected: number;
  userId: string;
  timestamp: string;
}
```

#### Metrics Updates
```typescript
interface MetricsUpdateEvent {
  type: 'METRICS_UPDATE';
  metrics: {
    hitRate: number;
    avgResponseTime: number;
    totalRequests: number;
  };
  timestamp: string;
}
```

***

## 5. Error Handling

### 5.1. Standard Error Codes
```typescript
enum ApiErrorCode {
  // Authentication
  UNAUTHORIZED = 'UNAUTHORIZED',
  FORBIDDEN = 'FORBIDDEN',
  TOKEN_EXPIRED = 'TOKEN_EXPIRED',
  
  // Validation
  INVALID_REQUEST = 'INVALID_REQUEST',
  MISSING_PARAMETER = 'MISSING_PARAMETER',
  INVALID_PARAMETER = 'INVALID_PARAMETER',
  
  // Resources
  NOT_FOUND = 'NOT_FOUND',
  PROPERTY_NOT_FOUND = 'PROPERTY_NOT_FOUND',
  
  // Rate Limiting
  RATE_LIMIT_EXCEEDED = 'RATE_LIMIT_EXCEEDED',
  
  // External Services
  RENTMAN_API_ERROR = 'RENTMAN_API_ERROR',
  CACHE_ERROR = 'CACHE_ERROR',
  IMAGE_PROCESSING_ERROR = 'IMAGE_PROCESSING_ERROR',
  
  // Server Errors
  INTERNAL_ERROR = 'INTERNAL_ERROR',
  SERVICE_UNAVAILABLE = 'SERVICE_UNAVAILABLE'
}
```

### 5.2. Error Response Format
```typescript
interface ApiError {
  error: string;
  code: ApiErrorCode;
  message: string;
  details?: {
    field?: string;
    constraint?: string;
    allowedValues?: any[];
  };
  requestId: string;
  timestamp: string;
}
```

### 5.3. Example Error Responses

**400 Bad Request:**
```json
{
  "error": "Invalid request parameters",
  "code": "INVALID_PARAMETER",
  "message": "The 'beds' parameter must be a positive integer",
  "details": {
    "field": "beds",
    "constraint": "positive_integer",
    "allowedValues": [1, 2, 3, 4, 5, "6+"]
  },
  "requestId": "req_123456789",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

**401 Unauthorized:**
```json
{
  "error": "Authentication required",
  "code": "UNAUTHORIZED",
  "message": "Valid authentication token required for admin endpoints",
  "requestId": "req_123456789",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

**404 Not Found:**
```json
{
  "error": "Property not found",
  "code": "PROPERTY_NOT_FOUND",
  "message": "Property with ID '999' does not exist",
  "requestId": "req_123456789",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

**429 Rate Limited:**
```json
{
  "error": "Rate limit exceeded",
  "code": "RATE_LIMIT_EXCEEDED",
  "message": "Too many requests. Limit: 100 requests per minute",
  "details": {
    "limit": 100,
    "period": "minute",
    "resetAt": "2024-01-15T10:31:00Z"
  },
  "requestId": "req_123456789",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

***

## 6. Rate Limiting

### 6.1. Rate Limits by Endpoint Type

| Endpoint Type | Rate Limit | Window |
|---------------|------------|---------|
| Public API | 1000 req/hour | Per IP |
| Admin API | 500 req/hour | Per User |
| Search API | 100 req/hour | Per IP |
| Media API | 200 req/hour | Per IP |

### 6.2. Rate Limit Headers
```http
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 999
X-RateLimit-Reset: 1642248600
X-RateLimit-Type: ip
```

***

## 7. Caching Headers

### 7.1. Cache Control Headers
```http
Cache-Control: public, max-age=300, stale-while-revalidate=600
ETag: "abc123def456"
Last-Modified: Mon, 15 Jan 2024 10:30:00 GMT
X-Cache-Status: HIT
X-Cache-TTL: 240
```

### 7.2. Cache Strategies by Endpoint

| Endpoint | TTL | Strategy |
|----------|-----|----------|
| /api/properties | 5 min | SWR |
| /api/properties/featured | 10 min | SWR |
| /api/properties/:id | 1 hour | SWR |
| /api/properties/:id/media | 24 hours | Cache-first |
| /api/areas | 6 hours | Cache-first |

***

## 8. Frontend-Specific Endpoints

### 8.1. GET /api/frontend/properties/featured
Enhanced featured properties endpoint with complete frontend optimization.

**Query Parameters:**
```typescript
interface FrontendFeaturedParams {
  count?: number;                  // Number of properties (default: 7, max: 12)
  imageVariant?: 'thumbnail' | 'card' | 'hero'; // Primary image variant
  includeBlur?: 'true';           // Include blur placeholders
  includeSEO?: 'true';            // Include SEO metadata
  format?: 'minimal' | 'complete'; // Response format
}
```

**Complete Frontend Response:**
```typescript
interface CompleteFrontendResponse {
  success: true;
  data: {
    properties: FrontendOptimizedProperty[];
    globalPreloads: {
      dns: string[];
      preconnect: string[];
      stylesheet: string[];
    };
    performance: {
      totalResponseTime: number;
      cacheStatus: 'hit' | 'miss' | 'partial';
      optimizationLevel: 'high' | 'medium' | 'low';
    };
  };
  meta: AutoFeaturedMeta;
}
```

### 8.2. POST /api/frontend/properties/progressive
Progressive property loading for infinite scroll and pagination.

**Request:**
```typescript
interface ProgressiveLoadRequest {
  lastPropref?: string;           // For pagination
  limit: number;                  // Properties to load
  filters?: PropertyFilters;      // Standard filters
  viewport: {                     // Viewport information for optimization
    width: number;
    height: number;
    pixelRatio: number;
    connection: 'slow-2g' | '2g' | '3g' | '4g' | '5g';
  };
  preloadNext?: boolean;          // Preload next batch
}
```

**Response:**
```typescript
interface ProgressiveLoadResponse {
  data: {
    properties: FrontendOptimizedProperty[];
    hasMore: boolean;
    nextCursor?: string;
    preloadedBatch?: FrontendOptimizedProperty[];
  };
  meta: {
    loadTime: number;
    optimizedFor: string;
    nextPreloadUrl?: string;
    totalAvailable: number;
  };
}
```

### 8.3. GET /api/frontend/performance/preload
Generate preload resources for performance optimization.

**Query Parameters:**
```typescript
interface PreloadParams {
  page: 'home' | 'properties' | 'property-detail';
  proprefs?: string[];           // Specific properties to preload
  priority: 'high' | 'medium' | 'low';
}
```

**Response:**
```typescript
interface PreloadResponse {
  data: {
    dns: string[];
    preconnect: string[];
    modulepreload: string[];
    prefetch: Array<{
      href: string;
      as: 'image' | 'script' | 'style' | 'font';
      type?: string;
      crossorigin?: boolean;
    }>;
    preload: Array<{
      href: string;
      as: string;
      type?: string;
      media?: string;
    }>;
  };
  meta: {
    generated: string;
    ttl: number;
    page: string;
  };
}
```

### 8.4. GET /api/frontend/seo/:propref
SEO-optimized property metadata for social sharing and search.

**Response:**
```typescript
interface SEOResponse {
  data: {
    title: string;
    description: string;
    canonical: string;
    openGraph: {
      title: string;
      description: string;
      image: string;
      imageAlt: string;
      type: 'website';
      url: string;
    };
    twitter: {
      card: 'summary_large_image';
      title: string;
      description: string;
      image: string;
      imageAlt: string;
    };
    structuredData: {
      '@context': 'https://schema.org';
      '@type': 'RealEstateListing';
      name: string;
      description: string;
      image: string[];
      offers: {
        '@type': 'Offer';
        price: string;
        priceCurrency: string;
      };
      address: {
        '@type': 'PostalAddress';
        addressRegion: string;
        addressCountry: string;
      };
    };
  };
  meta: {
    generated: string;
    propref: string;
    lastModified: string;
  };
}
```

### 8.5. WebSocket /ws/frontend/live-updates
Real-time updates for frontend applications.

**Connection:**
```typescript
const ws = new WebSocket('wss://api.london-move.com/ws/frontend/live-updates');
```

**Event Types:**
```typescript
// Featured properties updated
interface FeaturedUpdateEvent {
  type: 'FEATURED_UPDATED';
  data: {
    count: number;
    trigger: string;
    timestamp: string;
    affectedProprefs: string[];
  };
}

// Property status changed
interface PropertyStatusEvent {
  type: 'PROPERTY_STATUS_CHANGED';
  propref: string;
  oldStatus: string;
  newStatus: string;
  timestamp: string;
}

// New property added
interface PropertyAddedEvent {
  type: 'PROPERTY_ADDED';
  propref: string;
  type: string;
  area: string;
  price: string;
  timestamp: string;
}

// Cache warming completed
interface CacheWarmEvent {
  type: 'CACHE_WARM_COMPLETE';
  patterns: string[];
  duration: number;
  timestamp: string;
}
```

### 8.6. GET /api/frontend/health
Frontend-specific health check with performance metrics.

**Response:**
```typescript
interface FrontendHealthResponse {
  status: 'healthy' | 'degraded' | 'unhealthy';
  data: {
    api: {
      status: 'up' | 'down';
      responseTime: number;
    };
    cache: {
      memory: {
        hitRate: number;
        size: number;
      };
      redis: {
        hitRate: number;
        latency: number;
      };
    };
    images: {
      processingQueue: number;
      avgProcessingTime: number;
      cdnStatus: 'up' | 'down';
    };
    database: {
      status: 'up' | 'down';
      connectionPool: number;
    };
  };
  meta: {
    timestamp: string;
    version: string;
    environment: string;
  };
}
```

***

## 9. Performance Headers for Frontend

### 9.1. Response Headers
All frontend-optimized endpoints include performance headers:

```http
X-Response-Time: 45ms
X-Cache-Status: HIT
X-Optimization-Level: high
X-Image-Formats: avif,webp,jpeg
X-Frontend-Optimized: true
Link: <https://cdn.london-move.com>; rel=preconnect
Link: <https://fonts.googleapis.com>; rel=preconnect
```

### 9.2. CORS Headers for Frontend
```http
Access-Control-Allow-Origin: https://stupendous-share-046449.framer.app
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Content-Type, Authorization, X-Requested-With
Access-Control-Expose-Headers: X-Response-Time, X-Cache-Status
```

This comprehensive API specification provides all the details needed to integrate with the Cache-Only Rentman API Backend effectively, with specific optimizations for modern frontend frameworks like Framer.